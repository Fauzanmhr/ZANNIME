<%- include('partials/header', { title: 'Anime by Genre - ZANNIME' }) %>
<div class="container">
  <h1 class="mt-4">Anime by Genre: <%= genre %></h1>
  <div class="table-responsive">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Poster</th>
          <th>Judul</th>
          <th>Rating</th>
          <th>Studio</th>
          <th>Musim</th>
          <th>Genre</th>
          <th>Jumlah Episode</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <% animes.forEach(anime => { %>
          <tr>
            <td><img src="<%= anime.poster %>" alt="<%= anime.judul %>" class="img-fluid" style="max-width: 100px;"></td>
            <td><%= anime.judul %></td>
            <td><%= anime.rating %></td>
            <td><%= anime.studio %></td>
            <td><%= anime.musim %></td>
            <td>
              <ul>
                <% anime.genres.forEach(genre => { %>
                  <li><%= genre.judul %></li>
                <% }) %>
              </ul>
            </td>
            <td><%= anime.jumlahEpisode %></td>
            <td>
              <a href="/anime/<%= anime.slug %>" class="btn btn-dark btn-sm">View</a>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
  <!-- Pagination -->
  <nav aria-label="Anime list pagination">
    <ul class="pagination justify-content-center">
      <li class="page-item <%= !pagination.prevPage ? 'disabled' : '' %>">
        <a class="page-link" href="?page=<%= pagination.prevPage %>">Previous</a>
      </li>
      <%
        const maxPages = 5;
        const halfMax = Math.floor(maxPages / 2);
        let startPage = Math.max(1, pagination.currentPage - halfMax);
        let endPage = Math.min(pagination.totalPages, startPage + maxPages - 1);
        if (endPage - startPage < maxPages - 1) {
          startPage = Math.max(1, endPage - maxPages + 1);
        }
        for (let i = startPage; i <= endPage; i++) {
      %>
        <li class="page-item <%= pagination.currentPage === i ? 'active' : '' %>">
          <a class="page-link" href="?page=<%= i %>"><%= i %></a>
        </li>
      <% } %>
      <li class="page-item <%= !pagination.nextPage ? 'disabled' : '' %>">
        <a class="page-link" href="?page=<%= pagination.nextPage %>">Next</a>
      </li>
    </ul>
  </nav>
</div>
<%- include('partials/footer') %>
<!-- Bootstrap JS -->
<script src="/js/bootstrap.bundle.min.js"></script>
</body>
</html>